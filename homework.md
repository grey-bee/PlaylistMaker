# Задание на спринт

Макет приложения с новыми фичами лежит в Figma.

---

## Задача 1. Создать плейлист

Создайте экран с полями для заполнения информации о плейлисте.

### Требования:

1. **Переход к созданию плейлиста** — с экрана «Медиатека» при нажатии на кнопку «Новый плейлист» в разделе «Плейлисты».

2. **Кнопка «Создать»** — неактивна, если не заполнено поле «Название». Плейлист может не иметь обложки и описания, но название обязательно.

3. **Выбор обложки** — при нажатии на область обложки пользователь выбирает изображение из галереи, Google Photos или других источников. Выбранное изображение отображается в области обложки.

4. **Закрытие экрана** — кнопка «Назад», системная Back и жест закрывают экран.
   - Если данные не введены — возврат на предыдущий экран.
   - Если данные введены — показать диалог:
     - Заголовок: «Завершить создание плейлиста?»
     - Сообщение: «Все несохраненные данные будут потеряны»
     - Кнопки: «Отмена» (остаться) и «Завершить» (закрыть)

5. **Создание плейлиста** — при нажатии активной кнопки «Создать»:
   - Экран закрывается
   - Показывается Toast: «Плейлист [название] создан»
   - Файл обложки копируется в хранилище приложения

### Подсказки:

- Используйте **Fragment** и добавьте его в граф навигации с Action перехода
- Нижняя панель навигации на этом экране не отображается
- Для выбора изображения используйте **photo picker**
- При сохранении скопируйте файл в хранилище приложения
- Используйте **Toast** для сообщения о создании

### База данных (Entity):

| Поле | Описание |
|------|----------|
| id | Уникальный первичный ключ `@PrimaryKey(autoGenerate = true)` |
| name | Название плейлиста |
| description | Описание плейлиста |
| imagePath | Путь к файлу обложки |
| trackIds | Список идентификаторов треков (Gson → String) |
| trackCount | Количество треков |

### Архитектура:

- **DAO** — методы добавления и обновления плейлистов
- **Repository** — взаимодействие с DAO
- **Interactor** — сохранение плейлистов из Presentation слоя

---

## Задача 2. Отобразить список плейлистов

Список плейлистов отображается на экране «Медиатека» в разделе «Плейлисты» в две колонки.

### Требования:

1. **Отображение** — используйте `GridLayoutManager` для двух колонок
2. **Заглушка обложки** — если у плейлиста нет обложки
3. **Пустой список** — показать заглушку если плейлистов нет
4. **После создания** — новый плейлист сразу виден в списке

### Подсказки:

- Подготовьте layout элемента списка, ViewHolder и Adapter
- Создайте класс плейлиста в `domain.model` для слоёв Domain и Presentation
- Дополните DAO методом получения списка плейлистов
- Добавьте интерактор в ViewModel
- Обновляйте список при возвращении на экран (методы жизненного цикла)

---

## Задача 3. Добавить трек в плейлист

На экране «Аудиоплеер» при нажатии кнопки «Добавить в плейлист» показывается всплывающее окно со списком плейлистов и кнопкой «Новый плейлист».

### Логика добавления:

- **Трека нет в плейлисте** → список скрывается, трек добавляется, Toast: «Добавлено в плейлист [название]»
- **Трек уже есть** → список остаётся, Toast: «Трек уже добавлен в плейлист [название]»
- **Кнопка «Новый плейлист»** → переход на экран создания, возврат на «Аудиоплеер»

---

### Подзадача 1. Получить список плейлистов на экране «Аудиоплеер»

- Добавьте интерактор во ViewModel
- Подготовьте новый layout элемента, ViewHolder и Adapter
- Используйте **BottomSheetBehavior** (корневой ViewGroup — CoordinatorLayout)
- Обновляйте список при каждом открытии Bottom Sheet
- Используйте **Shape Drawable** для скруглённых углов

#### Затемнение (overlay):

```xml
<View android:id="@+id/overlay"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="#99000000"
    android:visibility="gone"/>
```

Управление видимостью в `BottomSheetCallback.onStateChanged()`:
- `STATE_HIDDEN` → `overlay.visibility = View.GONE`
- Остальные → `overlay.visibility = View.VISIBLE`

Плавное затемнение в `onSlide()`:
```kotlin
overlay.alpha = slideOffset  // slideOffset: -1f..1f, alpha: 0f..1f
```

---

### Подзадача 2. Добавить трек в плейлист

#### База данных:

Создайте таблицу для треков в плейлистах (те же поля, что у избранных треков).

**DAO:**
- Метод добавления трека
- `OnConflictStrategy.IGNORE` для дубликатов

#### Процесс добавления:

1. **ViewModel** проверяет наличие трека в плейлисте по списку ID
2. Если трек есть → сообщение в UI через LiveData
3. Если трека нет → передать трек и плейлист в репозиторий через интерактор
4. **Репозиторий**:
   - Обновляет список ID треков плейлиста
   - Увеличивает счётчик треков
   - Обновляет плейлист в БД через DAO
   - Сохраняет трек в таблицу треков
5. Возвращает статус успеха во ViewModel → UI

---

## Критерии успешного выполнения

### UI и работа приложения

#### Экран «Создание плейлиста»:

- [ ] Переход с «Медиатеки» по кнопке «Новый плейлист»
- [ ] Переход с «Аудиоплеера» по кнопке «Новый плейлист» в Bottom Sheet
- [ ] Сохранение данных при переходе в фоновый режим
- [ ] Диалог подтверждения при закрытии с введёнными данными
- [ ] Кнопка «Создать» активна только при заполненном названии
- [ ] Заглушка обложки / выбранное изображение
- [ ] Переход в галерею при нажатии на область обложки
- [ ] Сохранение и возврат при нажатии «Создать»

#### Экран «Медиатека»:

- [ ] Список плейлистов в 2 колонки
- [ ] Элемент: обложка, название, количество треков
- [ ] Заглушка обложки если нет изображения

#### Добавление трека в плейлист:

- [ ] Bottom Sheet со списком плейлистов
- [ ] Кнопка «Новый плейлист»
- [ ] Добавление трека с Toast сообщением
- [ ] Сообщение если трек уже в плейлисте
- [ ] Закрытие жестом смахивания вниз

### Код

- [ ] Приложение компилируется и запускается
- [ ] Плейлисты хранятся в Room БД
- [ ] Файл обложки копируется в хранилище приложения
- [ ] Треки в плейлистах хранятся в отдельной таблице
- [ ] Entity и DAO в слое Data
- [ ] Логика плейлистов в репозитории Domain-слоя
- [ ] ViewModel работает через интерактор
- [ ] UI получает данные через LiveData
- [ ] DTO-классы не используются в Domain/Presentation/UI